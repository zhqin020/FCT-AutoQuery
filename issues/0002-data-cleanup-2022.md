# Issue 0002: 数据异常清理 - 2022年案例数据修复

## Status: CLOSED
## Created: 2025-12-11
## Closed: 2025-12-11

## Problem Description
在批处理采集过程中，发现编号IMM-2334-22之后的案例存在异常数据：
1. 部分案例状态标记为success但docket_entries为空
2. 异常数据已保存到数据库，影响后续采集和处理

## Root Cause Analysis
1. **统计错误**: 批处理统计中`processed`计数器只跟踪线性收集阶段，未包含指数探测阶段处理的案例
2. **探测计数错误**: `probes`计数器未在每次检查案例时递增
3. **重复显示统计信息**: 最终运行统计与之前统计显示重复

## Resolution
修复了以下问题：

### 1. 批处理统计修复 (batch_service.py)
- 在指数探测循环中添加了`probes += 1`计数
- 调整了日志输出的位置，确保probes计数正确显示

### 2. 主程序统计修复 (main.py)
- 改进了处理数量的计算逻辑，包含指数探测阶段处理的案例
- 简化了最终摘要显示，避免重复输出

### 3. 数据库清理
删除了345条异常记录：
- 编号大于IMM-2334-22的所有2022年案例
- 状态为success但没有docket_entries记录的案例

## Acceptance Criteria
- ✅ 数据库中不再有success状态但没有docket_entries的2022年案例
- ✅ 数据库中不再有编号大于2334-22的2022年案例  
- ✅ 批处理统计正确显示实际处理的案例数量
- ✅ 探测次数统计正确
- ✅ 最终统计信息不重复显示

## Technical Changes
1. **src/services/batch_service.py**: 修复probes计数器
2. **src/cli/main.py**: 改进统计计算和显示
3. **数据库清理**: 删除345条异常记录

## Verification
清理后数据库状态：
- 2022年总案例: 2279
- 成功案例: 2165  
- 失败案例: 0
- 无数据案例: 114
- 成功但没有docket_entries的记录: 0
- 编号大于2334的记录: 0

## Impact
- 清理了异常数据，为后续采集提供干净的数据环境
- 修复了统计显示问题，提供准确的运行信息
- 确保了数据一致性